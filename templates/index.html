<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PandaWiki Lite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h1 class="mb-4 text-center">ğŸ“š MechMind </h1>

    <!-- ğŸ“ æ–°å»ºæ–‡ä»¶å¤¹ -->
    <div class="card mb-4">
        <div class="card-header">ğŸ“ æ–°å»ºæ–‡ä»¶å¤¹</div>
        <div class="card-body">
            <form action="/create_folder" method="post" class="row g-3">
                <div class="col-md-10">
                    <input type="text" name="folder_name" placeholder="è¾“å…¥æ–‡ä»¶å¤¹åç§°" class="form-control" required>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-secondary w-100">åˆ›å»º</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ğŸ“¤ ä¸Šä¼ æ–‡ä»¶ -->
    <div class="card mb-4">
        <div class="card-header">ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒ PDFã€DOCXã€TXTï¼‰</div>
        <div class="card-body">
            <form action="/upload" method="post" enctype="multipart/form-data" class="row g-3">
                <div class="col-md-4">
                    <input type="file" name="file" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <select name="folder" class="form-select" required>
                        {% for folder in folders %}
                        <option value="{{ folder }}">{{ folder }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary w-100">ä¸Šä¼ </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ğŸ’¬ æ™ºèƒ½é—®ç­” -->
    <div class="card mb-4">
        <div class="card-header">ğŸ’¬ æ™ºèƒ½é—®ç­” <small class="text-muted">(ç»“åˆä¸Šä¼ èµ„æ–™è¿›è¡Œå›ç­”)</small></div>
        <div class="card-body">
            <form action="/ask" method="post" class="row g-3">
                <div class="col-md-10">
                    <input type="text" name="question" placeholder="è¯·è¾“å…¥é—®é¢˜..." class="form-control" required>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-success w-100">æé—®</button>
                </div>
            </form>

            {% if voice_text %}
            <div class="mt-3 alert alert-warning">
                <strong>ğŸ“ è¯­éŸ³è¯†åˆ«å†…å®¹ï¼š</strong>
                <span id="recognized-text">{{ voice_text }}</span>
                <button class="btn btn-sm btn-outline-dark ms-2" onclick="copyText()">å¤åˆ¶</button>
            </div>
            {% endif %}

            {% if answer %}
            <div class="mt-3 alert alert-info">
                <strong>ğŸ¤– æ¨¡å‹å›ç­”ï¼š</strong> {{ answer }}
            </div>
            {% endif %}
<!--            {% if source_chunks %}-->
<!--            <div class="mt-3 card border-info">-->
<!--                <div class="card-header bg-info text-white">-->
<!--                    ğŸ” ä½¿ç”¨çš„èµ„æ–™ä¸Šä¸‹æ–‡ï¼ˆRAGå¬å›ï¼‰-->
<!--                </div>-->
<!--                <div class="card-body">-->
<!--                    <details>-->
<!--                        <summary>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ£€ç´¢åˆ°çš„ç‰‡æ®µ</summary>-->
<!--                        <ul class="mt-2">-->
<!--                            {% for chunk in source_chunks %}-->
<!--                            <li class="mb-2"><code>{{ chunk }}</code></li>-->
<!--                            {% endfor %}-->
<!--                        </ul>-->
<!--                    </details>-->
<!--                </div>-->
<!--            </div>-->
<!--            {% endif %}-->

            {% if source_chunks %}
            <div class="mt-3 alert alert-secondary">
                <strong>ğŸ“„ å¼•ç”¨èµ„æ–™ç‰‡æ®µï¼š</strong>
                <ul class="mt-2">
                    {% for chunk in source_chunks %}
                    <li style="font-size: small;">{{ chunk }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- ğŸ™ï¸ æµè§ˆå™¨è¯­éŸ³æé—® -->
    <div class="card mb-4">
        <div class="card-header">ğŸ™ï¸ æµè§ˆå™¨å½•éŸ³è¯†åˆ«æé—®</div>
        <div class="card-body">
            <button onclick="startRecording()" class="btn btn-warning">å¼€å§‹å½•éŸ³</button>
            <button onclick="stopRecording()" class="btn btn-secondary">åœæ­¢å½•éŸ³</button>
            <form id="voice-form" action="/ask_from_voice" method="post" enctype="multipart/form-data" class="mt-3">
                <input type="hidden" name="audio_blob" id="audio_blob_input">
                <button type="submit" class="btn btn-success mt-2">æäº¤å¹¶æé—®</button>
            </form>
            <p id="voice-status" class="mt-2 text-muted"></p>
        </div>
    </div>

    <!-- ğŸ“ ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶æé—® -->
    <div class="card mb-4">
        <div class="card-header">ğŸ“ ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶è¯†åˆ«æé—®</div>
        <div class="card-body">
            <form action="/ask_from_audio" method="post" enctype="multipart/form-data">
                <input type="file" name="audio_file" class="form-control" accept="audio/*" required>
                <input type="submit" class="btn btn-primary mt-2" value="æäº¤å¹¶æé—®">
            </form>
        </div>
    </div>

    <!-- ğŸ“Š ä¸Šä¼  Excel æ–‡ä»¶æé—® -->
    <div class="card mb-4">
        <div class="card-header">ğŸ“Š ä¸Šä¼  Excel è¡¨æ ¼æé—®</div>
        <div class="card-body">
            <form action="/ask_from_excel" method="post" enctype="multipart/form-data">
                <input type="file" name="excel_file" class="form-control" accept=".xlsx,.xls" required>
                <textarea name="excel_question" class="form-control mt-2" placeholder="è¯·è¾“å…¥ä½ å¯¹ Excel è¡¨æ ¼çš„æé—®..." rows="3" required></textarea>
                <input type="submit" class="btn btn-success mt-2" value="æäº¤é—®é¢˜">
            </form>
        </div>
    </div>

    <!-- ğŸ“‚ æ–‡ä»¶ç®¡ç† -->
    {% for folder, files in folder_files.items() %}
    <div class="card mb-3">
        <div class="card-header">{{ folder }}</div>
        <div class="card-body">
            {% if files %}
            <ul class="list-group">
                {% for file in files %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ file }}
                    <span>
                        <a href="{{ url_for('view_file', folder=folder, filename=file) }}" target="_blank" class="btn btn-sm btn-outline-secondary">æŸ¥çœ‹</a>
                        <a href="{{ url_for('download_file', folder=folder, filename=file) }}" class="btn btn-sm btn-outline-primary">ä¸‹è½½</a>
                        <a href="{{ url_for('delete_file', folder=folder, filename=file) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('ç¡®è®¤åˆ é™¤ {{ file }} å—ï¼Ÿ')">åˆ é™¤</a>
                    </span>
                </li>
                {% endfor %}
            </ul>
            {% else %}
                <p>ï¼ˆè¯¥æ–‡ä»¶å¤¹æš‚æ— æ–‡ä»¶ï¼‰</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- ğŸ“¢ JS å¼•å…¥ -->
<script src="{{ url_for('static', filename='recorder.js') }}"></script>
<script>
function copyText() {
    const text = document.getElementById("recognized-text").innerText;
    navigator.clipboard.writeText(text).then(function () {
        alert("âœ… å·²å¤åˆ¶è¯†åˆ«å†…å®¹ï¼");
    }, function (err) {
        alert("âŒ æ— æ³•å¤åˆ¶ï¼š" + err);
    });
}
</script>

</body>
</html>
